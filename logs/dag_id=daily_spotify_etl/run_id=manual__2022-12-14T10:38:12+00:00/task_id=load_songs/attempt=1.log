[2022-12-14T10:38:21.092+0000] {taskinstance.py:1087} INFO - Dependencies all met for <TaskInstance: daily_spotify_etl.load_songs manual__2022-12-14T10:38:12+00:00 [queued]>
[2022-12-14T10:38:21.105+0000] {taskinstance.py:1087} INFO - Dependencies all met for <TaskInstance: daily_spotify_etl.load_songs manual__2022-12-14T10:38:12+00:00 [queued]>
[2022-12-14T10:38:21.107+0000] {taskinstance.py:1283} INFO - 
--------------------------------------------------------------------------------
[2022-12-14T10:38:21.108+0000] {taskinstance.py:1284} INFO - Starting attempt 1 of 1
[2022-12-14T10:38:21.109+0000] {taskinstance.py:1285} INFO - 
--------------------------------------------------------------------------------
[2022-12-14T10:38:21.131+0000] {taskinstance.py:1304} INFO - Executing <Task(_PythonDecoratedOperator): load_songs> on 2022-12-14 10:38:12+00:00
[2022-12-14T10:38:21.168+0000] {standard_task_runner.py:55} INFO - Started process 20417 to run task
[2022-12-14T10:38:21.178+0000] {standard_task_runner.py:82} INFO - Running: ['***', 'tasks', 'run', 'daily_spotify_etl', 'load_songs', 'manual__2022-12-14T10:38:12+00:00', '--job-id', '66', '--raw', '--subdir', 'DAGS_FOLDER/daily_dag.py', '--cfg-path', '/tmp/tmpb2jo6vtg']
[2022-12-14T10:38:21.195+0000] {standard_task_runner.py:83} INFO - Job 66: Subtask load_songs
[2022-12-14T10:38:21.327+0000] {task_command.py:389} INFO - Running <TaskInstance: daily_spotify_etl.load_songs manual__2022-12-14T10:38:12+00:00 [running]> on host b92abc15fbab
[2022-12-14T10:38:21.424+0000] {taskinstance.py:1513} INFO - Exporting the following env vars:
AIRFLOW_CTX_DAG_OWNER=***
AIRFLOW_CTX_DAG_ID=daily_spotify_etl
AIRFLOW_CTX_TASK_ID=load_songs
AIRFLOW_CTX_EXECUTION_DATE=2022-12-14T10:38:12+00:00
AIRFLOW_CTX_TRY_NUMBER=1
AIRFLOW_CTX_DAG_RUN_ID=manual__2022-12-14T10:38:12+00:00
[2022-12-14T10:38:21.869+0000] {logging_mixin.py:137} INFO - Token Refreshed
[2022-12-14T10:38:21.875+0000] {logging_mixin.py:137} INFO - Running Daily Task
[2022-12-14T10:38:21.880+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014301880 slot 0
[2022-12-14T10:38:22.160+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014294680 slot 1
[2022-12-14T10:38:22.398+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014287480 slot 2
[2022-12-14T10:38:22.649+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014280280 slot 3
[2022-12-14T10:38:22.882+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014273080 slot 4
[2022-12-14T10:38:23.106+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014265880 slot 5
[2022-12-14T10:38:23.326+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014258680 slot 6
[2022-12-14T10:38:24.354+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014251480 slot 7
[2022-12-14T10:38:24.622+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014244280 slot 8
[2022-12-14T10:38:24.858+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014237080 slot 9
[2022-12-14T10:38:25.126+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014229880 slot 10
[2022-12-14T10:38:25.355+0000] {logging_mixin.py:137} INFO - Getting songs for 1671014222680 slot 11
[2022-12-14T10:38:25.653+0000] {logging_mixin.py:137} INFO - <class 'sqlalchemy.engine.base.Engine'>
[2022-12-14T10:38:25.656+0000] {logging_mixin.py:137} INFO - 50
[2022-12-14T10:38:25.692+0000] {base.py:73} INFO - Using connection ID 'spotify_etl' for task execution.
[2022-12-14T10:38:25.719+0000] {logging_mixin.py:137} INFO - (psycopg2.errors.ForeignKeyViolation) insert or update on table "history" violates foreign key constraint "history_user_id_fkey"
DETAIL:  Key (user_id)=(1) is not present in table "users".

[SQL: INSERT INTO history (name, played_at, album_name, artist_name, user_id) VALUES (%(name)s, %(played_at)s, %(album_name)s, %(artist_name)s, %(user_id)s)]
[parameters: ({'name': 'Wind in Our Sail', 'played_at': '2022-12-14T05:17:22.577Z', 'album_name': 'Weezer (White Album) [Deluxe Edition]', 'artist_name': 'Weezer', 'user_id': 1}, {'name': 'California Kids', 'played_at': '2022-12-14T05:14:29.067Z', 'album_name': 'Weezer (White Album) [Deluxe Edition]', 'artist_name': 'Weezer', 'user_id': 1}, {'name': 'Vultures - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T07:13:00.365Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}, {'name': 'Try - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T07:11:58.076Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}, {'name': 'Wait Until Tomorrow - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T07:05:04.537Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}, {'name': 'Daughters - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T07:00:47.771Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}, {'name': 'Who Did You Think I Was - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T06:54:24.030Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}, {'name': 'Who Did You Think I Was - Live at the House of Blues, Chicago, Illinois, September 22, 2005', 'played_at': '2022-12-13T06:51:24.218Z', 'album_name': 'TRY! - Live In Concert', 'artist_name': 'John Mayer', 'user_id': 1}  ... displaying 10 of 50 total bound parameter sets ...  {'name': 'Back Seat Lover', 'played_at': '2022-12-11T10:02:00.370Z', 'album_name': 'Where Does This Door Go (Deluxe Edition)', 'artist_name': 'Mayer Hawthorne', 'user_id': 1}, {'name': 'Stitched Up (feat. John Mayer)', 'played_at': '2022-12-11T09:56:43.295Z', 'album_name': 'Possibilities (U.S. Version)', 'artist_name': 'Herbie Hancock', 'user_id': 1})]
(Background on this error at: https://sqlalche.me/e/14/gkpj)
[2022-12-14T10:38:25.726+0000] {python.py:177} INFO - Done. Returned value was: None
[2022-12-14T10:38:25.772+0000] {taskinstance.py:1327} INFO - Marking task as SUCCESS. dag_id=daily_spotify_etl, task_id=load_songs, execution_date=20221214T103812, start_date=20221214T103821, end_date=20221214T103825
[2022-12-14T10:38:26.003+0000] {local_task_job.py:159} INFO - Task exited with return code 0
[2022-12-14T10:38:26.107+0000] {taskinstance.py:2582} INFO - 0 downstream tasks scheduled from follow-on schedule check
